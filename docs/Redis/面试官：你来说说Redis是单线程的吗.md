å“ˆå–½ï¼Œå¤§å®¶å“ˆï¼Œæˆ‘æ˜¯ **DanMu**ã€‚ä»Šå¤©åœ¨åˆ·åšå®¢çš„æ—¶å€™åˆ·åˆ°ä¸€ä¸ªæŒºæœ‰æ„æ€çš„é¢è¯•é¢˜ï¼šâ€œ Redis **æ˜¯å•çº¿ç¨‹çš„å—ï¼Ÿ**â€åœ¨å¹³æ—¶çœ‹çš„æ–‡ç« ä¸­éƒ½ä¼šè¯´ Redis æ˜¯å•çº¿ç¨‹çš„ã€‚ä½†æ˜¯ Redis ä¸­åŒæ ·å­˜åœ¨ç€å¼‚æ­¥æ‰§è¡Œçš„æ“ä½œï¼Œæ¯”å¦‚`bgsave` å‘½ä»¤ï¼Œå®ƒå®ƒå…è®¸åœ¨åå°å¼‚æ­¥åœ°å°†å½“å‰æ•°æ®æŒä¹…åŒ–åˆ°ç£ç›˜ï¼Œæ—¢ç„¶æ˜¯å¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆå¿…ç„¶å­˜åœ¨å¤šä¸ªçº¿ç¨‹ï¼Œä¸ºä»€ä¹ˆè¿˜è¯´ Redis æ˜¯å•çº¿ç¨‹çš„å‘¢ï¼Ÿ
![NB-Panda (1).png](https://cdn.nlark.com/yuque/0/2024/png/29091075/1715610631202-30193877-23d6-42c2-a831-c1fbd820d2f4.png#averageHue=%23b7b7b7&clientId=u788567c0-8795-4&from=paste&height=191&id=u470b797a&originHeight=450&originWidth=450&originalType=binary&ratio=1.5&rotation=0&showTitle=false&size=105016&status=done&style=none&taskId=u48056c7f-599b-43e5-89db-1bad74a647d&title=&width=191)
å…¶å® Redis åœ¨4.0ä¹‹åå°±å·²ç»éƒ¨åˆ†å¼•å…¥äº†å¤šçº¿ç¨‹æœºåˆ¶ï¼Œæˆ‘ä»¬å¹³å¸¸è¯´çš„ Redis æ˜¯å•çº¿ç¨‹çš„ï¼Œä¸»è¦æŒ‡çš„æ˜¯** Redis å¯¹å¤–æä¾›é”®å€¼å¯¹å­˜å‚¨æœåŠ¡**çš„ä¸»è¦åŠŸèƒ½ï¼Œä¹Ÿå°±æ˜¯**ç½‘ç»œè¯·æ±‚**å’Œ**æ•°æ®æ“ä½œ**æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹å®Œæˆçš„ã€‚è€Œå…¶ä»–ä¾‹å¦‚æŒä¹…åŒ–å­˜å‚¨æ¨¡å—ã€é›†ç¾¤æ”¯æ’‘æ¨¡å—ç­‰å‡å¯ä»¥ç”±å¤šçº¿ç¨‹å®Œæˆã€‚åœ¨ Redis 6.0 ç‰ˆæœ¬ä¸­ï¼Œç½‘ç»œè¯·æ±‚å¤„ç†éƒ¨åˆ†è¿æ¥äº†ä¸€æ¬¡é‡å¤§æ›´æ–°ï¼Œå¼•å…¥äº†å¤šçº¿ç¨‹æ¨¡å‹ã€‚è¿™æ„å‘³ç€ Redis åœ¨æ¥æ”¶ç½‘ç»œè¯·æ±‚æ—¶ï¼Œèƒ½å¤Ÿåˆ©ç”¨å¤šä¸ªçº¿ç¨‹å¹¶è¡Œå¤„ç†ï¼Œä»è€Œå¤§å¤§æé«˜äº†å¹¶å‘æ€§èƒ½ã€‚
> å³ä½¿æ˜¯åœ¨æ•°æ®æ“ä½œä¸­ï¼Œä¹Ÿå¹¶ä¸æ˜¯å®Œå…¨çš„å•çº¿ç¨‹ï¼Œä¾‹å¦‚ unlink å‘½ä»¤ï¼Œä½œç”¨å°±æ˜¯å°† key-value è¿›è¡Œå¼‚æ­¥åˆ é™¤ã€‚

##  Redis ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹
â€œå•çº¿ç¨‹â€è¿™ä¸ªè¯æ±‡ï¼Œåœ¨å¾ˆå¤šåœºæ™¯ä¸­å¸¸ä¸â€œä½æ•ˆâ€ç›¸æå¹¶è®ºã€‚ç¡®å®ï¼ŒMysqlä»¥åŠå¤§é‡ä¸­é—´ä»¶éƒ½ç§¯ææ‹¥æŠ±å¤šçº¿ç¨‹æŠ€æœ¯ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆ Redis ç‰¹ç«‹ç‹¬è¡Œçš„é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹ï¼Œè€Œä¸ç”¨å¤šçº¿ç¨‹æ¥æé«˜æ•ˆç‡å‘¢ï¼Ÿè¦å›ç­”è¿™ä¸ªé—®é¢˜å…¶å®åªéœ€è¦ä¸‰ä¸ªå­—ï¼š**æ²¡å¿…è¦**ï¼
![](https://cdn.nlark.com/yuque/0/2024/webp/29091075/1715612337695-d7dec7ce-a3d3-4400-9824-6c87bf471038.webp#averageHue=%23c5c5c5&clientId=u788567c0-8795-4&from=paste&id=u1a39b736&originHeight=198&originWidth=198&originalType=url&ratio=1.5&rotation=0&showTitle=false&status=done&style=none&taskId=u721ab88b-9090-4c2d-b203-abb8148809f&title=)
å“ˆå“ˆå“ˆå“ˆå“ˆå“ˆï¼Œä½†æ˜¯ä½œä¸ºä¸€ä¸ªæœ‰èŠ‚æ“çš„ä½œè€…ï¼Œè¿˜æ˜¯è¦æ·±å…¥åˆ†æä¸€ä¸‹ Redis ä½¿ç”¨å•çº¿ç¨‹çš„å…·ä½“åŸå› ã€‚è¦è¯´æ¸…æ¥šè¿™ç‚¹ï¼Œå°±éœ€è¦å…ˆäº†è§£å¤šçº¿ç¨‹çš„ä½¿ç”¨åœºæ™¯ã€‚
### å¤šçº¿ç¨‹çš„é€‚ç”¨åœºæ™¯
ä¸€ä¸ªè®¡ç®—æœºç¨‹åºåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œä¸»è¦éœ€è¦è¿›è¡Œä¸¤ç§æ“ä½œåˆ†åˆ«æ˜¯è¯»å†™æ“ä½œå’Œè®¡ç®—æ“ä½œã€‚å…¶ä¸­è¯»å†™æ“ä½œä¸»è¦æ˜¯æ¶‰åŠåˆ°çš„å°±æ˜¯ IO æ“ä½œï¼Œå…¶ä¸­åŒ…æ‹¬ç½‘ç»œ IO å’Œç£ç›˜ IO ï¼Œè€Œè®¡ç®—æ“ä½œä¸»è¦æ¶‰åŠåˆ° CPU ã€‚è€Œå¤šçº¿ç¨‹çš„ç›®çš„ï¼Œå°±æ˜¯é€šè¿‡å¹¶å‘çš„æ–¹å¼æ¥**æå‡ IO çš„åˆ©ç”¨ç‡å’Œ CPU çš„åˆ©ç”¨ç‡**ã€‚
å¯¹äº Redis æ¥è¯´ï¼Œ CPU èµ„æºæ ¹æœ¬å°±ä¸æ˜¯ Redis çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ‰€ä»¥ Redis ä¸éœ€è¦é€šè¿‡å¤šçº¿ç¨‹æŠ€æœ¯æ¥æå‡ CPU åˆ©ç”¨ç‡ã€‚è€Œ Redis çš„æ“ä½œåŸºæœ¬éƒ½æ˜¯åŸºäºå†…å­˜çš„ï¼Œå› æ­¤ç£ç›˜ IO ä¹Ÿå¾ˆéš¾æˆä¸ºç“¶é¢ˆï¼Œ Redis é¢ä¸´çš„æœ€å¤§æŒ‘æˆ˜å…¶å®æ˜¯**ç½‘ç»œ IO **ï¼Œæ—©æœŸè®¾è®¡è€…è®¤ä¸ºé€šè¿‡** IO å¤šè·¯å¤ç”¨æŠ€æœ¯**å°±è¶³ä»¥åº”å¯¹å¤§éƒ¨åˆ†åœºæ™¯ï¼Œä½†æ˜¯éšç€ä½¿ç”¨è€…å¯¹äº Redis çš„è¦æ±‚è¶Šæ¥è¶Šé«˜ï¼Œåœ¨6.0ç‰ˆæœ¬ä¸­ä¸å¾—ä¸å¼•å…¥å¤šçº¿ç¨‹æ¥åº”å¯¹æ—¥ç›Šå¢é•¿çš„ç½‘ç»œæ€§èƒ½è¦æ±‚ï¼Œè¿™ä¸ªæˆ‘ä»¬åé¢å†è¯´ã€‚
### å¤šçº¿ç¨‹çš„å¼Šç«¯
ä»»ä½•æŠ€æœ¯éƒ½æ˜¯ä¸€ä½“ä¸¤é¢ï¼Œé‡‡ç”¨å¤šçº¿ç¨‹å¯ä»¥å¸®åŠ©æˆ‘ä»¬æå‡ CPU å’ŒI/Oçš„åˆ©ç”¨ç‡ï¼Œä½†æ˜¯å¤šçº¿ç¨‹å¸¦æ¥çš„å¹¶å‘é—®é¢˜ä¹Ÿä¼šå¸¦æ¥**æ¡†æ¶è®¾è®¡ä¸Šçš„å¤æ‚æ€§**ã€‚è€Œä¸”ï¼Œå¤šçº¿ç¨‹æ¨¡å‹ä¸­ï¼Œå¤šä¸ªçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢ä¹Ÿä¼šå¸¦æ¥ä¸€å®šçš„**æ€§èƒ½å¼€é”€**ã€‚å› æ­¤ï¼ŒRedis çš„ä½œè€…è®¤ä¸ºå¼•å…¥å¤šçº¿ç¨‹å¹¶ä¸èƒ½ä¸º Redis å¸¦æ¥æ€§èƒ½ä¸Šçš„æå‡ï¼Œåè€Œä¼šå¸¦æ¥è®¾è®¡ä¸Šçš„å¤æ‚æ€§ï¼Œå› æ­¤ Redis æœ€ç»ˆé€‰æ‹©äº†ç®€å•çš„å•çº¿ç¨‹æ¨¡å‹ã€‚
##  Redis ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹è¿˜é‚£ä¹ˆå¿«å‘¢
 Redis  ä¸ºä»€ä¹ˆä½¿ç”¨å•çº¿ç¨‹è¿˜é‚£ä¹ˆå¿«å‘¢ï¼Ÿè¿™ä¹Ÿæ˜¯é¢è¯•ä¸­ç»å¸¸å‡ºç°çš„ä¸€ä¸ªé—®é¢˜ï¼Œè¦å›ç­”è¿™ä¸ªä¸»è¦éœ€è¦ä»å››ä¸ªéƒ¨åˆ†å…¥æ‰‹ï¼š

1.  Redis æ˜¯**å•çº¿ç¨‹**çš„ï¼Œè¿™ä¸»è¦æŒ‡çš„æ˜¯ Redis çš„å•çº¿ç¨‹æ¨¡å‹é¿å…äº†ä¸åŒçº¿ç¨‹ä¹‹é—´å¯¹äºå…±äº«èµ„æºçš„ç«äº‰ï¼ŒåŒæ—¶å‡å°‘äº†çº¿ç¨‹åˆ‡æ¢çš„å¼€é”€ã€‚
2.  Redis å…·æœ‰**é«˜æ•ˆçš„æ•°æ®ç»“æ„**ï¼Œ Redis çš„æ•°æ®ç»“æ„éƒ½ç»è¿‡äº†ç²¾å¿ƒçš„ä¼˜åŒ–ï¼Œåœ¨æ•ˆç‡å’Œç©ºé—´ä¸Šéƒ½å…·æœ‰æé«˜çš„æ•ˆç‡ï¼Œå½“ç„¶è¿™ä¸æ˜¯ä¸€ä¸¤å¥è¯èƒ½å¤Ÿè¯´æ¸…çš„ï¼Œæœ‰æœºä¼šæˆ‘ä¼šå¦å¤–å†™ä¸€ç¯‡æ–‡ç« æ¥è¯´è¯´ Redis çš„æ•°æ®ç»“æ„ã€‚
3.  Redis æ˜¯**åŸºäºå†…å­˜**çš„ï¼Œå¯¹äºæ•°æ®çš„æ“ä½œéƒ½åœ¨å†…å­˜ä¸­è¿›è¡Œï¼Œå› æ­¤æ‰€éœ€è¦æå°‘çš„ IO æ—¶é—´
4.  Redis é‡‡ç”¨** IO å¤šè·¯å¤ç”¨**æ¥åŠ å¿« IO åˆ©ç”¨ç‡ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å°±å¯ä»¥ç›‘å¬å¤šä¸ª IO äº‹ä»¶ã€‚
> **IO å¤šè·¯å¤ç”¨**æŠ€æœ¯æ˜¯ä¸€ç§åˆ©ç”¨å•ä¸ªçº¿ç¨‹ç›‘å¬å¤šä¸ªIOæ¥å£çš„æŠ€æœ¯ï¼Œé€šå¸¸ç”±æ“ä½œç³»ç»Ÿæä¾›ã€‚

## ä¸ºä»€ä¹ˆ Redis 6.0åˆå¼•å…¥äº†å¤šçº¿ç¨‹
> éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ Redis 6.0ä¸­çš„å¼•å…¥çš„å¤šçº¿ç¨‹ï¼Œé€šå¸¸æŒ‡é’ˆå¯¹å¤„ç†**ç½‘ç»œè¯·æ±‚**è¿‡ç¨‹å¼•å…¥çš„å¤šçº¿ç¨‹ã€‚

è¿™ä¸»è¦æ˜¯ç”±äº Redis é¢å¯¹çš„åœºæ™¯è¶Šæ¥è¶Šå¤æ‚ã€‚æ ¹æ®æµ‹ç®—ï¼Œ Redis  å°†æ‰€æœ‰æ•°æ®æ”¾åœ¨å†…å­˜ä¸­ï¼Œå†…å­˜çš„å“åº”æ—¶é•¿å¤§çº¦ä¸º 100 çº³ç§’ï¼Œå¯¹äºå°æ•°æ®åŒ…ï¼Œ Redis  æœåŠ¡å™¨å¯ä»¥å¤„ç† 80,000 åˆ° 100,000 QPSï¼Œè¿™ä¹ˆé«˜çš„å¯¹äº 80% çš„å…¬å¸æ¥è¯´ï¼Œå•çº¿ç¨‹çš„ Redis å·²ç»è¶³å¤Ÿä½¿ç”¨äº†ã€‚
ä½†éšç€è¶Šæ¥è¶Šå¤æ‚çš„ä¸šåŠ¡åœºæ™¯ï¼Œæœ‰äº›å…¬å¸åŠ¨ä¸åŠ¨å°±ä¸Šäº¿çš„äº¤æ˜“é‡ï¼Œå› æ­¤éœ€è¦æ›´å¤§çš„ QPSã€‚ä¸ºäº†æå‡QPSï¼Œå¾ˆå¤šå…¬å¸çš„åšæ³•æ˜¯éƒ¨ç½² Redis é›†ç¾¤ï¼Œå¹¶ä¸”å°½å¯èƒ½æå‡ Redis æœºå™¨æ•°ã€‚ä½†æ˜¯è¿™ç§åšæ³•çš„èµ„æºæ¶ˆè€—æ˜¯å·¨å¤§çš„ã€‚
ç»è¿‡åˆ†æï¼Œé™åˆ¶ Redis çš„æ€§èƒ½çš„ä¸»è¦ç“¶é¢ˆå‡ºç°åœ¨ç½‘ç»œ IO çš„å¤„ç†ä¸Šï¼Œè™½ç„¶ä¹‹å‰é‡‡ç”¨äº†**å¤šè·¯å¤ç”¨**æŠ€æœ¯ã€‚ä½†æ˜¯**å¤šè·¯å¤ç”¨çš„ IO æ¨¡å‹æœ¬è´¨ä¸Šä»ç„¶æ˜¯åŒæ­¥é˜»å¡å‹ IO æ¨¡å‹**ã€‚è¿™é‡Œç®€å•è§£é‡Šä¸€ä¸‹**åŒæ­¥é˜»å¡å‹ IO æ¨¡å‹**
![Rediså•çº¿ç¨‹-ç¬¬ 4 é¡µ.drawio.png](https://cdn.nlark.com/yuque/0/2024/png/29091075/1715763851219-5c4f6a2d-a8c4-4092-b84e-5286de1f97e5.png#averageHue=%23f8f8f8&clientId=u26e8f9c1-c4a2-4&from=paste&height=4921&id=u83cecaf1&originHeight=4921&originWidth=6307&originalType=binary&ratio=1&rotation=0&showTitle=false&size=3169514&status=done&style=none&taskId=u87efad07-24fe-4abe-a2ab-20db799fe2f&title=&width=6307)
ä»ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨å¤šè·¯å¤ç”¨çš„ IO æ¨¡å‹ä¸­ï¼Œåœ¨å¤„ç†ç½‘ç»œè¯·æ±‚æ—¶ï¼Œè°ƒç”¨ selectçš„è¿‡ç¨‹æ˜¯é˜»å¡çš„ï¼Œä¹Ÿå°±æ˜¯è¯´è¿™ä¸ªè¿‡ç¨‹ä¼šé˜»å¡çº¿ç¨‹ï¼Œå¦‚æœå¹¶å‘é‡å¾ˆé«˜ï¼Œæ­¤å¤„å¯èƒ½ä¼šæˆä¸ºç“¶é¢ˆã€‚
è™½ç„¶ç°åœ¨å¾ˆå¤šæœåŠ¡å™¨éƒ½æ˜¯å¤šä¸ª CPU æ ¸çš„ï¼Œä½†æ˜¯å¯¹äº Redis æ¥è¯´ï¼Œå› ä¸ºä½¿ç”¨äº†å•çº¿ç¨‹ï¼Œåœ¨ä¸€æ¬¡æ•°æ®æ“ä½œçš„è¿‡ç¨‹ä¸­ï¼Œæœ‰å¤§é‡çš„ CPU æ—¶é—´ç‰‡æ˜¯è€—è´¹åœ¨äº†ç½‘ç»œ IO çš„åŒæ­¥å¤„ç†ä¸Šçš„ï¼Œå¹¶æ²¡æœ‰å……åˆ†çš„å‘æŒ¥å‡ºå¤šæ ¸çš„ä¼˜åŠ¿ã€‚
**å¦‚æœèƒ½é‡‡ç”¨å¤šçº¿ç¨‹ï¼Œä½¿å¾—ç½‘ç»œå¤„ç†çš„è¯·æ±‚å¹¶å‘è¿›è¡Œï¼Œå°±å¯ä»¥å¤§å¤§çš„æå‡æ€§èƒ½ã€‚å¤šçº¿ç¨‹é™¤äº†å¯ä»¥å‡å°‘ç”±äºç½‘ç»œ I/O ç­‰å¾…é€ æˆçš„å½±å“ï¼Œè¿˜å¯ä»¥å……åˆ†åˆ©ç”¨  CPU  çš„å¤šæ ¸ä¼˜åŠ¿ã€‚**
##  Redis çš„ç½‘ç»œæ¨¡å‹
æ—¢ç„¶æåˆ°äº† Redis çš„å¤šçº¿ç¨‹ï¼Œä½œä¸ºä¸€ä¸ªè®¤çœŸçš„ä½œè€…ï¼Œè‡ªç„¶ä¸èƒ½æµ…å°è¾„æ­¢ã€‚æ¥ä¸‹æ¥ï¼Œè®©æˆ‘ä»¬æ¥æ·±å…¥ç†è§£ä¸€ä¸‹ Redis çš„ç½‘ç»œ IO æ¨¡å‹ã€‚
 Redis çš„ç½‘ç»œæ¨¡å‹ä¾ç„¶åŸºäºé¼é¼å¤§åçš„Reactoræ¨¡å¼ï¼Œå¤§é‡çŸ¥åçš„å¼€æºä¸­é—´ä»¶ä¾‹å¦‚Nettyã€Nginxéƒ½ä½¿ç”¨äº†è¿™ä¸€æŠ€æœ¯ã€‚å…¶å®ç›¸è¾ƒäºReactoræ¨¡å¼ï¼Œæˆ‘æ›´å–œæ¬¢å«ä»–Dispatchæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯åˆ†å‘å™¨æ¨¡å¼ï¼Œè¿™æ›´æ¥è¿‘äºå®ƒçš„æœ¬è´¨ã€‚æ ¹æ®åˆ†å‘å™¨å’Œå¤„ç†çº¿ç¨‹çš„æ•°é‡ï¼Œé€šå¸¸åˆå¯ä»¥åˆ†ä¸ºä¸‰ç§æ¨¡å¼ï¼š

1. å•åˆ†å‘å™¨å•çº¿ç¨‹
2. å•åˆ†å‘å™¨å¤šçº¿ç¨‹
3. å¤šåˆ†å‘å™¨å¤šçº¿ç¨‹

åœ¨è¿™é‡Œæˆ‘ä»¬ä¸»è¦è®¨è®ºä¸ Redis ç›¸å…³çš„å‰ä¸¤ç§ã€‚
### å•åˆ†å‘å™¨å•çº¿ç¨‹![Rediså•çº¿ç¨‹-ç¬¬ 1 é¡µ.drawio.png](https://cdn.nlark.com/yuque/0/2024/png/29091075/1715763269212-4b26a321-20aa-48fe-a0e1-20a053bf67e0.png#averageHue=%23f3d8b4&clientId=u1aecb49f-2b37-4&from=paste&height=2493&id=BXZie&originHeight=2493&originWidth=5013&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8175694&status=done&style=none&taskId=u1505505d-ed1d-4c84-9a6f-b680d4282c3&title=&width=5013)
Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆ IO  å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹

- å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶
- å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”

åœ¨ Redis 6.0ä¹‹å‰ï¼Œä½¿ç”¨çš„ä¾¿æ˜¯è¿™ç§æ¨¡å¼ï¼Œå½“ç„¶ï¼Œè¿™ç§æ¨¡å¼çš„ç¼ºç‚¹åŒæ ·ååˆ†æ˜æ˜¾ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½åœ¨åŒä¸€ä¸ªçº¿ç¨‹ä¸­å®Œæˆï¼Œä¸€æ—¦å‡ºç°ä¸€ä¸ªé«˜è€—æ—¶çš„ä¸šåŠ¡ï¼Œåç»­çš„ä¸šåŠ¡ç”šè‡³æ˜¯è¿æ¥äº‹ä»¶éƒ½éœ€è¦ç­‰å¾…ã€‚
### å•åˆ†å‘å™¨å¤šçº¿ç¨‹
ä¸ºäº†å…‹æœå•åˆ†å‘å™¨å•çº¿ç¨‹çš„ç¼ºç‚¹ï¼Œå°±éœ€è¦å¼•å…¥å¤šè¿›ç¨‹ï¼Œæ–¹æ¡ˆçš„ç¤ºæ„å›¾å¦‚ä¸‹å›¾æ‰€ç¤º
![Rediså•çº¿ç¨‹-ç¬¬ 2 é¡µ.drawio.png](https://cdn.nlark.com/yuque/0/2024/png/29091075/1715763556450-8742547b-1b2e-412f-b414-5b2bd5f95b35.png#averageHue=%23fcfaf6&clientId=u26e8f9c1-c4a2-4&from=paste&height=2958&id=u61f24c5b&originHeight=2958&originWidth=3262&originalType=binary&ratio=1&rotation=0&showTitle=false&size=8748953&status=done&style=none&taskId=uc157f5b1-8358-4d62-90c2-477e2057a55&title=&width=3262)

- Reactor å¯¹è±¡é€šè¿‡ select ï¼ˆ IO  å¤šè·¯å¤ç”¨æ¥å£ï¼‰ ç›‘å¬äº‹ä»¶ï¼Œæ”¶åˆ°äº‹ä»¶åé€šè¿‡ dispatch è¿›è¡Œåˆ†å‘ï¼Œå…·ä½“åˆ†å‘ç»™ Acceptor å¯¹è±¡è¿˜æ˜¯ Handler å¯¹è±¡ï¼Œè¿˜è¦çœ‹æ”¶åˆ°çš„äº‹ä»¶ç±»å‹ï¼›
- å¦‚æœæ˜¯è¿æ¥å»ºç«‹çš„äº‹ä»¶ï¼Œåˆ™äº¤ç”± Acceptor å¯¹è±¡è¿›è¡Œå¤„ç†ï¼ŒAcceptor å¯¹è±¡ä¼šé€šè¿‡ accept æ–¹æ³• è·å–è¿æ¥ï¼Œå¹¶åˆ›å»ºä¸€ä¸ª Handler å¯¹è±¡æ¥å¤„ç†åç»­çš„å“åº”äº‹ä»¶ï¼›
- å¦‚æœä¸æ˜¯è¿æ¥å»ºç«‹äº‹ä»¶ï¼Œ åˆ™äº¤ç”±å½“å‰è¿æ¥å¯¹åº”çš„ Handler å¯¹è±¡æ¥è¿›è¡Œå“åº”ï¼›

ä¸Šé¢çš„ä¸‰ä¸ªæ­¥éª¤å’Œå• Reactor å•çº¿ç¨‹æ–¹æ¡ˆæ˜¯ä¸€æ ·çš„ï¼Œæ¥ä¸‹æ¥çš„æ­¥éª¤å°±å¼€å§‹ä¸ä¸€æ ·äº†ï¼š

- Handler å¯¹è±¡ä¸å†è´Ÿè´£ä¸šåŠ¡å¤„ç†ï¼Œåªè´Ÿè´£æ•°æ®çš„æ¥æ”¶å’Œå‘é€ï¼ŒHandler å¯¹è±¡é€šè¿‡ read è¯»å–åˆ°æ•°æ®åï¼Œä¼šå°†æ•°æ®å‘ç»™å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼›
- å­çº¿ç¨‹é‡Œçš„ Processor å¯¹è±¡å°±è¿›è¡Œä¸šåŠ¡å¤„ç†ï¼Œå¤„ç†å®Œåï¼Œå°†ç»“æœå‘ç»™ä¸»çº¿ç¨‹ä¸­çš„ Handler å¯¹è±¡ï¼Œæ¥ç€ç”± Handler é€šè¿‡ send æ–¹æ³•å°†å“åº”ç»“æœå‘é€ç»™ clientï¼›

è¿™ä¸ªæ–¹æ¡ˆçš„æœ‰ç‚¹åœ¨äºèƒ½å¤Ÿå……åˆ†åˆ©ç”¨å¤šçº¿ç¨‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¹Ÿå­˜åœ¨é—®é¢˜ï¼Œç”±äºå­çº¿ç¨‹åªè´Ÿè´£è¿›è¡Œä¸šåŠ¡çš„å¤„ç†ï¼Œæ‰€æœ‰çš„**å‘é€ä¾ç„¶éœ€è¦ä¸»çº¿ç¨‹è´Ÿè´£**ï¼Œè¿™å°±è¿™ä¸ä»…ä¼šå¯¼è‡´å­çº¿ç¨‹å¯¹ä¸»çº¿ç¨‹çš„ç«äº‰ï¼ŒåŒæ—¶å½“å¹¶å‘é‡å¤§çš„æ—¶å€™ï¼Œä¸»çº¿ç¨‹åŒæ ·ä¼šæˆä¸ºç“¶é¢ˆï¼Œå› æ­¤ Redis å¹¶æ²¡æœ‰ç›´æ¥ä½¿ç”¨è¿™ä¸ªæ–¹æ¡ˆï¼Œè€Œæ˜¯è¿›è¡Œäº†ä¸€å®šçš„ä¿®æ”¹ã€‚
###  Redis çš„å¤šçº¿ç¨‹æ–¹æ¡ˆ
![Rediså•çº¿ç¨‹-ç¬¬ 3 é¡µ.drawio.png](https://cdn.nlark.com/yuque/0/2024/png/29091075/1715763761734-461b635f-c323-4c92-b116-04aa9199fae6.png#averageHue=%23faf8f4&clientId=u26e8f9c1-c4a2-4&from=paste&height=4956&id=uc5833aca&originHeight=4956&originWidth=5467&originalType=binary&ratio=1&rotation=0&showTitle=false&size=10242095&status=done&style=none&taskId=u179a92be-ee77-4237-8533-e5de630fe99&title=&width=5467)
 Redis å¯¹å•åˆ†å‘å™¨å¤šçº¿ç¨‹çš„æ–¹æ¡ˆè¿›è¡Œäº†ä¸€å®šçš„æ”¹è¿›ï¼Œä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œä¸»è¦æ˜¯æœ‰ä¸¤ç‚¹ä¸åŒï¼š

1. å°†æ•°æ®çš„æ¥æ”¶å’Œå‘é€éƒ½çº³å…¥åˆ°äº†å­çº¿ç¨‹å½“ä¸­ï¼Œè¿™æ ·å¯ä»¥é¿å…åœ¨é«˜å¹¶å‘æ—¶ï¼Œä¸»çº¿ç¨‹çš„å¤„ç†èƒ½åŠ›æˆä¸ºç“¶é¢ˆ
2. ä¸šåŠ¡ä¾ç„¶åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯å› ä¸º Redis åŸå§‹çš„è®¾è®¡ä¾¿æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ¨¡å‹ï¼Œè¿™æ ·å¯ä»¥å°½é‡ä¿è¯æ•´ä½“ç»“æ„çš„ä¸€è‡´æ€§ï¼Œå‡å°‘ä¿®æ”¹æˆæœ¬ã€‚  
## ç‚¹å…³æ³¨ï¼Œä¸è¿·è·¯
> å¥½äº†ï¼Œä»¥ä¸Šå°±æ˜¯è¿™ç¯‡æ–‡ç« çš„å…¨éƒ¨å†…å®¹äº†ï¼Œå¦‚æœä½ èƒ½çœ‹åˆ°è¿™é‡Œï¼Œ**éå¸¸æ„Ÿè°¢ä½ çš„æ”¯æŒï¼**
> å¦‚æœä½ è§‰å¾—è¿™ç¯‡æ–‡ç« å†™çš„è¿˜ä¸é”™ï¼Œ æ±‚**ç‚¹èµ**ğŸ‘ æ±‚**å…³æ³¨**â¤ï¸ æ±‚**åˆ†äº«**ğŸ‘¥ å¯¹æš–ç”·æˆ‘æ¥è¯´çœŸçš„ **éå¸¸æœ‰ç”¨ï¼ï¼ï¼**
> ç™½å«–ä¸å¥½ï¼Œåˆ›ä½œä¸æ˜“ï¼Œå„ä½çš„æ”¯æŒå’Œè®¤å¯ï¼Œå°±æ˜¯æˆ‘åˆ›ä½œçš„æœ€å¤§åŠ¨åŠ›ï¼Œæˆ‘ä»¬ä¸‹ç¯‡æ–‡ç« è§ï¼
> å¦‚æœæœ¬ç¯‡åšå®¢æœ‰ä»»ä½•é”™è¯¯ï¼Œè¯·æ‰¹è¯„æŒ‡æ•™ï¼Œä¸èƒœæ„Ÿæ¿€ ï¼

> æœ€åæ¨èæˆ‘çš„**IMé¡¹ç›®DiTing**ï¼ˆ[https://github.com/danmuking/DiTing-Go](https://github.com/danmuking/DiTing-Go)ï¼‰ï¼Œè‡´åŠ›äºæˆä¸ºä¸€ä¸ªåˆå­¦è€…å‹å¥½ã€æ˜“äºä¸Šæ‰‹çš„ IM è§£å†³æ–¹æ¡ˆï¼Œå¸Œæœ›èƒ½ç»™ä½ çš„å­¦ä¹ ã€é¢è¯•å¸¦æ¥ä¸€ç‚¹å¸®åŠ©ï¼Œå¦‚æœäººæ‰ä½ å–œæ¬¢ï¼Œç»™ä¸ªStarâ­å­ï¼


## å‚è€ƒèµ„æ–™
[https://segmentfault.com/a/1190000041275783](https://segmentfault.com/a/1190000041275783)
[https://zhuanlan.zhihu.com/p/452981967](https://zhuanlan.zhihu.com/p/452981967)
