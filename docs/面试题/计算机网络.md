## TCP头部包含哪些字段
1. 原端口
2. 目的端口
3. 序列号
4. 确认号
5. 校验和
6. 若干标志位
7. 窗口大小
## TCP和UDP的区别

1. 可靠性
   1. tcp通过三次握手，四次回收，重传等机制保证可靠性
   2. udp不可靠
2. 连接性
   1. TCP是面向连接的
   2. UDP不需要连接
3. 有序性
   1. TCP通过重传保证有序性
   2. UDP不保证消息有序
4. 拥塞控制
   1. TCP提供拥塞控制
   2. UDP不提供拥塞控制
5. 量级
   1. TCP是重量级的
   2. UDP是轻量级的
## TCP怎样保证连接的可靠性

1. 通过确认机制和超时重传保证数据发送的可靠性
2. 通过校验和保证数据的可靠性
3. 通过三次握手和四次回收保证连接的有效性
4. 通过拥塞控制保证网络环境的可靠性
5. 通过滑动窗口进行流量控制保证接受方接受的可靠性
## TCP三次握手过程

1. 请求连接方发送建立连接请求，设置同步标志位并随机生成一个序列号
2. 被请求方收到建立连接请求，设置同步表示位，同样生成一个序列号并ack收到的请求
3. 请求连接方收到应答，开始发送数据
## TCP四次挥手过程

1. 请求方发送带有FIN标记断开连接请求，进入FIN_WAIT_1状态
2. 接收方接受消息，发送ACK，进入CLOSE_WAIT状态，继续处理未处理数据
3. 请求方接受ACK请求，进入FIN_WAIT_2状态
4. 接收方发送完剩余数据，发送FIN请求，进入LAST_ACK状态；
5. 请求方接受消息，发送ACK请求，进入TIME_WAIT状态，等待2MSL后关闭连接
6. 发送方接受ACK，关闭连接
## 为什么TCP要三次握手，不是四次或两次

1. 避免建立历史连接
2. 同步序列号
3. 避免资源的浪费
## TIME_WAIT出现在TCP连接的什么时候
TIME_WAIT出现在请求关闭连接方在接受被关闭请求方的FIN报文并向北关闭方发送ACK报文之后。TIME_WAIT将等待2MSL后关闭连接。
## TIME_WAIT为什么要等待2MSL
MSL表示的报文的最长生存时间，当超过MSL后可以认为报文已经消失在网络中。

1. 等待2MSL可以保证当前连接的所有报文都已经失效，避免下一次连接意外接受到在网络中阻塞的报文。
2. 等待2MSL可以允许最后一个ACK报文丢失一次，发送方可以在进行一次重传。
## 如果大量连接都进入time wait状态会有什么问题

1. 占用系统资源，如文件描述符，内存资源
2. 占用端口资源，
## 重传

1. 超时重传
2. 快速重传
3. SACK
4. Duplicate SACK
## 流量控制

1. 滑动窗口
2. 操作系统和滑动窗口的关系
3. 窗口关闭
4. 糊涂窗口综合征
## 拥塞控制

1. 慢启动
2. 拥塞避免
3. 拥塞发生
4. 快速回复
## HTTP
### 介绍一下HTTP连接的流程

1. 采用DNS将域名转换为IP地址
2. 采用TCP三次握手建立连接
3. 发起HTTP报文
### 缓存

1. 协议缓存
2. 强制缓存
## HTTP长连接
当一个http请求完成后，不立刻释放对应TCP连接，而是重复使用这个TCP连接进行HTTP的发送，这样可以减少三次握手和四次回收的损耗。当一个HTTP请求发出后，后续的一段时间（超时时间）后没有发送新的HTTP报文，那么这个TCP就会断开。
### HTTP和RPC的区别

1. 目的不同
   1. HTTP出现的目的是为了指定一个统一的标准，便于浏览器进行访问
   2. RPC主要是在公司内部集群中使用，在不同服务间进行调用
2. 服务发现的对象不同
   1. HTTP需要使用DNS协议将网址解析为对应的地址
   2. RPC一般通过Consul等中间服务进行服务发现
3. 底层连接
   1. RPC会建立一个连接池进行连接复用
4. 传输内容
   1. HTTP为了提供较好的兼容性，内容有比较多的冗余
   2. RPC用于公司内部调用，可以进行专门的优化

HTTP/2后的性能已经比很多RPC协议要好，有许多RPC协议已经开始基于HTTP实现
## HTTPS
### HTTPS RSA握手
过程

1. 客户端生成随机数client-random，发送给服务端
2. 服务端接受client-random，同样生成随机数server-random，和证书一起发送给客户端
3. 客户端验证证书，生成pre-master，利用client-random+server-random+pre-master生成会话秘钥，用服务端公钥加密后发送给服务端
4. 服务端用私钥解码pre-master，生成同样的会话秘钥

缺点

1. client-random和server-random都是所有人可见的，一旦服务器私钥泄漏，pre-master就可能被解码，会话秘钥被破解。如果有人拦截了过去所有的通信，就可以破解过去所有的会话。
### HTTPS ECDHE握手
主要在生成pre-master这一部分进行了改进，pre-master不再由客户端生成而是采用ECDHE算法生成
ECDHE算法利用了离散对数的性质，离散对数主要由两个性质

1. 可以从a计算出A，但是给定A很难推算出a
2. 满足交换率，f(a,b) = f(b,a)

ECDHE算法的流程可以概括为

1. 选定一个函数f(a)=A，计算出客户端公钥，交给服务端
2. 服务端采用同一个函数f(b)=B
3. 现在双方可见A、B、f。a和b为私钥，保存在对应端
4. 由于ECDHE算法满足交换律，因此A^b=B^a=K，K即为pre-master

对于每一个会话，都可以随机生成一次a和b，即使某一次会话被破解，但是其他会话不收影响。
## DNS

1. DNS是什么：域名系统
2. 作用：将域名转换为ip地址
3. 域名分层：
   1. 根域名
   2. 顶级域名
   3. 二级域名
4. 域名服务器分层
   1. 根域名服务器
   2. 顶级域名服务器
   3. 权威域名服务器
   4. 本地域名服务器
5. DNS查询方式
   1. 递归
   2. 迭代
6. DNS查询过程
   1. 首先想请求本地域名服务器
   2. 如果没有则请求根域名服务器，获得所属顶级域名服务器
   3. 请求顶级域名服务器，获得权威域名服务器，获得ip
7. DNS缓存
   1. 浏览器缓存
   2. 操作系统缓存
8. DNS基于TCP还是UDP
   1. DNS区域传输的时候使用TCP协议
   2. 域名解析时使用UDP协议
## Reactor模型

1. 单Reactor单进程![单Reactor单进程.webp](https://raw.githubusercontent.com/danmuking/image/main/600a2a7bf6beddfd0b76e56d41917216.webp)
   1. 缺点
      1. 无法利用多核性能
      2. 如果处理过程比较长，将会阻塞新连接
2. 单Reactor多进程![单Reactor多线程.webp](https://raw.githubusercontent.com/danmuking/image/main/4a36503a979ab7f45ecf9fb96dfc9489.webp)
   1. 缺点
      1. 接收和响应客户端都在主进程进行，子线程处理完需要调用主线程返回响应，存在竞争，当突然高并发时，接收和发送可能成为瓶颈
3. 多Reactor多进程![主从Reactor多线程.webp](https://raw.githubusercontent.com/danmuking/image/main/9bceedf09dddef4b492940e26a6123dd.webp)
