支持多类型的消息表，是怎么设计的？
![复杂图片.jpg](https://raw.githubusercontent.com/danmuking/image/main/4fb773a0751d52fd33c2082bebc21ce0.jpeg)
我们能够支持文件，视频，pdf，图片，语音，文本。这么多类型的消息，这个表结构该如何设计呢？
首先来思考下，文件，视频，图片，他们都是啥。真抽象起来，不全部都是一个文件吗，一个存在oss里面的**url**。有了这个思路就简单了。
我们只需要添加一个上传的接口，这些类型的消息，前端只需要上传后记录url，提交给我们即可。
参考[腾讯sdk](https://cloud.tencent.com/document/product/269/2720)。我们的[多类型消息文档](https://www.yuque.com/snab/mallchat/rkb2uz5k1qqdmcmd)。
[https://drawsql.app/teams/-328/diagrams/-8](https://drawsql.app/teams/-328/diagrams/-8)
![image.png](https://raw.githubusercontent.com/danmuking/image/main/d70ccf9282aeaa66b7b723e30b6eb9dd.png)
消息最重要的其实就是两个字段。
`type`：指定消息是什么类型。
`extra`：放置不同类型消息的详情，如果是特别重要的消息，还可以通过设置关联表的方式，扩展出去，比如红包类型消息。
这里的`content`，`reply_msg_id`,`gap_count`其实都是文本类型的消息才有的字段，也可以扔extra里面去。由于一开始的历史兼容问题，没有删除字段，后续可以移除，让消息表更简洁。
消息表最重要的就是**谁**，在哪个**房间**，发送了什么**类型**的消息。**详情**都可以在**extra**里面。
